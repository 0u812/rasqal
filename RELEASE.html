<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <title>Rasqal RDF Query Library - Release Notes</title>
</head>
<body>

  <h1>Rasqal RDF Query Library - Release Notes</h1>

<h2 id="rel0_9_8"><a name="rel0_9_8">Rasqal 0.9.8 Changes</a></h2>

<p>Not yet released</p>


<h3>SPARQL Query Language Changes</h3>

<p>Grammar updated to follow the
<a href="http://www.w3.org/TR/2005/WD-rdf-sparql-query-20050217/">SPARQL Query Language for RDF</a>,
W3C Working Draft, 17 February 2005.
</p>

<p>Added support for casting in constraint expresions for datatyped literals
with the syntax <em>qname</em><code>(</code><em>literal</em><code>)</code>
such as <code>xsd:decimal("10")</code>.
</p>


<h3>Query Engine Changes</h3>

<p>Engine now operates over a hierarchy of rasqal_graph_pattern,
at the root the query has a single <em>query graph</em> rather than
a sequence of graph patterns.  The query graph contains the sequence now.</p>

<p>Constraints can be applied to any graph pattern, not just at the
top level of a query.</p>

<p>Added casting expressions type <code>RASQAL_EXPR_CAST</code>
and constructor <code>rasqal_new_cast_expression</code>.</p>

<p>Fixed setting of a triple origin (SPARQL <code>GRAPH</code>) which
was not working in 0.9.7</p>


<h3>Query API Changes</h3>

<p>Added no-arg constructor
<code>rasqal_new_graph_pattern</code>
</p>

<p>Added method
<code>rasqal_graph_pattern_add_triples</code>
to add triples to an existing graph pattern.
</p>

<p>Added methods
<code>rasqal_graph_pattern_add_constraint</code>,
<code>rasqal_graph_pattern_get_constraint_sequence</code> and
<code>rasqal_graph_pattern_get_constraint</code>
to add constraints to a graph pattern.
</p>

<p>Added method
<code>rasqal_graph_pattern_add_sub_graph_pattern</code>
to add a sub-graph pattern to a graph pattern.
</p>

<p>Added a <em>Data Graph</em> class with constructor
<code>rasqal_new_data_graph</code>, destructor
<code>rasqal_free_data_graph</code> and debug method
<code>rasqal_data_graph_print</code>.
</p>

<p>Added query methods for data graphs:
<code>rasqal_query_add_data_graph</code>,
<code>rasqal_query_get_data_graph_sequence</code>,
<code>rasqal_query_get_data_graph</code>.
</p>

<p>Deprecated query methods
<code>rasqal_query_add_constraint</code>,
<code>rasqal_query_get_constraint_sequence</code>
<code>rasqal_query_get_constraint</code>,
<code>rasqal_query_add_source</code>,
<code>rasqal_query_get_source_sequence</code> and
<code>rasqal_query_get_source</code>.  These will be removed in the
next release.</p>

<p>Removed functions deprecated in previous version:
<code>rasqal_query_get_variable_sequence</code>
and <code>rasqal_query_add_triple</code>.
</p>


<h2 id="rel0_9_7"><a name="rel0_9_7">Rasqal 0.9.7 Changes</a></h2>

<h3>General Changes</h3>

<p>Fix a resource clean up when query results are either not read at
all or not fully exhausted.  This caused a problem in Redland when it
held on to MySQL database handles despite a query having ended.</p>

<p>Added option <code>-n/--dryrun</code> to <code>roqet</code> to stop after
preparing the query.  Added option <code>-w/--walk-query</code> to
walk and print the query using the graph API.</p>

<p>Portability fixes for win32 - define <code>RASQAL_INLINE</code>
and use it as for raptor.  (Dave Viner)</p>

<p>Make rasqal tests work when building against raptor in a sibling
source tree.</p>


<h3>Query Engine Changes</h3>

<p>Added a graph pattern API with <code>rasqal_graph_pattern</code>
typedef and <code>rasqal_pattern_flags</code> enum with value
<code>RASQAL_PATTERN_FLAGS_OPTIONAL</code> to allow complete
walking of the query structure.</p>

<p>Two new methods to the query class were added to support this:
<code>rasqal_query_get_graph_pattern_sequence</code> to get the
raptor_sequence of graph patterns in a query and
<code>rasqal_query_get_graph_pattern</code> to get individual an
graph pattern by index.</p>

<p>The new graph pattern methods added are:</p>
<ul>
  <li><code>rasqal_graph_pattern_get_triple</code> to get a
  <code>raptor_triple</code> inside a graph pattern.</li>
  <li><code>rasqal_graph_pattern_get_sub_graph_pattern_sequence</code> to
  get the raptor_sequence of sub-graph patterns.</li>
  <li><code>rasqal_graph_pattern_get_sub_graph_pattern</code> to get
  a sub-graph pattern inside a graph pattern by index.</li>
  <li><code>rasqal_graph_pattern_get_flags</code> to get a graph
  pattern's flags.</li>
  <li><code>rasqal_graph_pattern_print</code> to print a graph
  pattern in a debug form.</li>
</ul>

<p>Deprecated <code>rasqal_query_add_triple</code> as it doesn't
construct the graph patterns and is of little use as it does not
build the correct query structures.</p>

<p>Added query API methods to get the bound and all variables
in a query:  <code>rasqal_query_get_bound_variable_sequence</code>
and <code>rasqal_query_get_all_variable_sequence</code> respectively.
Deprecated <code>rasqal_query_get_variable_sequence</code> as
too ambiguous.</p>

<p>With the aid of gcc <code>-Wswitch-enum</code>, found and fixed
cases where switch on enumerated values were missing cases.  The
remaining cases return failure or an error message rather than
abort().  This fixed a crash when comparing for equality a variable
?x with a blank node value and an interger.</p>

<p>Deleted <code>RASQAL_EXPR_PATTERN</code> as it was never used.</p>

<p>Added <code>rasqal_query_get_distinct</code> to get a
query-specified distinct results flag.</p>

<p>Added <code>rasqal_query_get_limit</code> to get a query-specified
limit on the number of results.</p>



<h3>SPARQL Query Language Changes</h3>

<p>Updated some of the SPARQL syntax to match the changes in the
<a href="http://www.w3.org/TR/2005/WD-rdf-sparql-query-20050217/">SPARQL Query Language for RDF</a>
W3C Working Draft of 17 February 2005.  Added <code>GRAPH</code>
replacing <code>SOURCE</code> and <code>WITH</code> replacing
<code>FROM</code>.  Added warnings about using the older forms
and about using <code>[</code>...<code>]</code> instead of
<code>OPTIONAL</code>.
</p>

<p>Added recording of <code>DISTINCT</code> and <code>LIMIT</code>
in the query structures but not yet used by the query engine.</p>



<h3>RDQL Query Language Changes</h3>

<p>None.</p>



<h2 id="rel0_9_6"><a name="rel0_9_6">Rasqal 0.9.6 Changes</a></h2>

<h3>General Changes</h3>

<p>Fix a bug in writing a query result to XML when blank nodes are
used. Now also correctly uses the base URI when pass in to the
writing method.</p>

<p>Added support for three types of query result - bindings (the only
one in previous versions), an RDF graph and a boolean.  Added
<code>rasqal_query_results</code> methods to test the type of the
result: <code>rasqal_query_results_is_bindings</code>,
<code>rasqal_query_results_is_boolean</code> and
<code>rasqal_query_results_is_graph</code>.</p>

<p>Added
<code>rasqal_query_results_get_triple</code>
to get current triple as a <code>raptor_statement</code>
and <code>rasqal_query_results_next_triple</code> to move to the next triple.
</p>

<p>Added 
<code>rasqal_query_results_get_boolean</code>
to get a boolean query result value.
</p>

<p>Added <code>rasqal_triple</code> copy constructor
<code>rasqal_new_triple_from_triple</code>.
</p>



<h3>Query Engine Changes</h3>

<p>Constructs an RDF graph result as a sequence of triples.  This
enables the SPARQL <code>CONSTRUCT</code> form to work.
</p>

<p>Can return a boolean result indicating that there were variable
binding results, but not returning them.  This enables the SPARQL
<code>ASK</code> form to work.
</p>

<p>Added a new function expression - rasqal_op enum value
<code>RASQAL_EXPR_FUNCTION</code>, added new <code>name</code> and
<code>args</code> fields to the <code>rasqal_expression</code>
structure and added <code>rasqal_new_function_expression</code> to
construct this expression.
</p>

<p>Added new 1-argument expression <code>RASQAL_EXPR_STR</code>
returning a string version of the expression.</p>

<p>Added new 1-argument expressions operating on RDF literals:
<code>RASQAL_EXPR_LANG</code> returning the language string of an RDF literal,
<code>RASQAL_EXPR_DATATYPE</code> returning the datatype URI of an RDF literal.
</p>

<p>Added new 1-argument testing expressions returning booleans:
<code>RASQAL_EXPR_BOUND</code> true if the variable argument is bound to a value,
<code>RASQAL_EXPR_ISURI</code> true if the argument is a URI,
<code>RASQAL_EXPR_ISBLANK</code> true if the argument is a blank node and
<code>RASQAL_EXPR_ISLITERAL</code> true if the argument is an RDF literal.
</p>

<p>Fixed a problem in optional results returning extra results
with no new bindings.
</p>


<h3>SPARQL Query Language Changes</h3>

<p>The SPARQL Parser now allows UTF-8 and \u, \U in prefixes and
QNames.
</p>

<p>Now supports <code>CONSTRUCT</code> and <code>ASK</code>
queries using the updated query engine features.</p>

<p><code>OPTIONAL</code> can now be used wherever <code>[</code> ...
<code>]</code> could be used (parser bug fix).</p>

<p>Now supports the SPARQL built-in functions
<code>STR()</code> returning a string version of the expression,
<code>LANG()</code> returning the language string of an RDF literal,
<code>DATATYPE()</code> returning the datatype URI of an RDF literal,
<code>BOUND()</code> testing if a variable is bound,
<code>ISURI()</code> testing if an expression is a URI,
<code>ISBLANK()</code> testing if an expression is a blank node and
<code>ISLITERAL()</code> testing if an expression is an RDF literal.
</p>

<p>Now supports SPARQL <code>BASE</code> directive for setting the
base URI of a query.  This is <em>experimental</em> and may not be in
the next version or may not be in the final SPARQL language.</p>

<p>The parser now expands QNames correctly when used in literals like
<code>"blah"^^xsd:string</code>.
</p>


<h3>RDQL Query Language Changes</h3>

<p>The RDQL Parser now allows UTF-8 and \u, \U in prefixes and
QNames.  This makes RDQL testsuite tests S-03, S-04 and S-05 work.
</p>



<h2 id="rel0_9_5"><a name="rel0_9_5">Rasqal 0.9.5 Changes</a></h2>

<p>A release with major changes internal to the query engine to
operate over graph patterns instead of sequences of triple patterns
and to add execution of optional graph patterns.  Additionally the
query results can now be written in a recognised XML format.</p>

<p>This version of Rasqal requires
<a href="http://librdf.org/raptor/">Raptor</a> 1.4.4.</p>


<h3>Core Changes</h3>

<p>Added a <code>rasqal_graph_pattern</code> class for handling
matching a graph pattern (set of triple patterns) in an
<code>rasqal_query</code>.  RDQL only has one of these wheras SPARQL
may have many, and they may be nested (this may change, as SPARQL is
under development).</p>

<p>Added <code>rasqal_query_results_write</code> method to write
variable binding query results to a <code>raptor_iostream</code> in
the XML format defined by
<a href="http://www.w3.org/TR/2004/WD-rdf-sparql-XMLres-20041221/">SPARQL Variable Binding Results XML Format</a>, W3C Working Draft, 21 December 2004.
</p>



<h3>Query Engine Changes</h3>

<p>Updated the query engine to operate over graph patterns rather
than a single sequence of triple patterns.  The graph patterns may be
optional, which is used to implement SPARQL optionals.  Nested graph
patterns are constructed but cannot yet be executed.
</p>

<p>Added a unary minus expression type.</p>

<p>Improved the type promotion for expression evaluation.  Try to
evaluate strings as doubles or integers if the operation contains one
double or integer respectively.</p>

<p>Fixed a memory leak with string matches/non-matches.</p>


<h3>SPARQL Query Language Changes</h3>

<p>Optional graph patterns <code>OPTIONAL</code> and
<code>[</code> ... <code>]</code> now work.</p>

<p>Added the <code>{</code> ... <code>}</code> group syntax and
removed the <code>(</code> ... <code>)</code> form.</p>

<p><code>$</code> was added as an allowed variable prefixes.</p>

<p>A warning was added to show <code>SOURCE *</code> is ignored.</p>

<p>Added the <code>UNION</code> keyword, unsupported.</p>

<p>Rasqal now passes the
<a href="http://www.w3.org/2001/sw/DataAccess/">DAWG</a>
SPARQL 
<a href="http://www.w3.org/2001/sw/DataAccess/tests/">test cases</a>:
Optional triples (dawg-opt-query-001, dawg-opt-query-002,
dawg-opt-query-003, dawg-opt-query-004)
and examples from query WD (sparql-query-example-2.1a,
sparql-query-example-2.2a, sparql-query-example-2.3a,
sparql-query-example-2.4a, sparql-query-example-3)
</p>

<p>Allow UTF-8 qname prefixes and check name against XML name
constraints.</p>

<p>Recover lexer state from errors in regexes.</p>

<p>Terminate the lexer on a syntax error, rather than produce
multiple errors.</p>


<h3>RDQL Query Language Changes</h3>

<p>The lexer now handles UTF-8 qname prefixes, enabling RDQL
testsuite test S-02 to pass.</p>

<p>Allow UTF-8 qname prefixes and check name against XML name
constraints.</p>

<p>Recover lexer state from errors in regexes.</p>

<p>Terminate the lexer on a syntax error, rather than produce
multiple errors.</p>



<h2 id="rel0_9_4"><a name="rel0_9_4">Rasqal 0.9.4 Changes</a></h2>

<p>Pass on raptor parser errors to rasqal's error routines and
upwards.</p>

<p>Clean up several memory allocations when a query fails to prepare
or execute fully.</p>

<p>Fixed lexer jams when a query contained an illegal
variable name after a '?'.</p>

<p>Fixed lexer crashes when a query ended in a regex pattern like
<code>/abc/</code>.</p>

<p>Tidied up the testing framework so 'make distcheck' works.</p>


<h2 id="rel0_9_3"><a name="rel0_9_3">Rasqal 0.9.3 Changes</a></h2>

<p>Rasqal's License was changed from LGPL 2.1/MPL 1.1 to
LGPL 2.1/Apache 2</p>

<p>Added support for the
<a href="http://www.w3.org/TR/2004/WD-rdf-sparql-query-20041012/">
SPARQL Query Language for RDF</a>,
W3C Working Draft, 12 October 2004
from the W3C RDF Data Access Working Group (DAWG).
The support is at the basic syntax level - token lexer and grammar parser
which passes the first simple tests from the proposed
DAWG testcases.  No additional query engine support has been added for SPARQL
features that are not supported by RDQL.  The
<a href="http://librdf.org/rasqal/TODO.html#sparql">Rasqal to do list</a>
contains full details of the implementation state.
</p>

<p>Queries can now be prepared and then executed multiple times.</p>

<p>Added configure <code>--enable-query-languages</code> option with
<code>rdql</code> and <code>sparql</code> as the choices.</p>

<p>Thanks to Chris Pointon for several patches to make Rasqal easier
to build under Win32.  Applied with some modifications.  Renamed the
RDQL and SPARQL syntax tokens ERROR to ERROR_TOKEN to help.</p>

<p>Added experimental support for querying multiple sources; the same
query is executed over each source in turn.  Also added some support
for returning the source URI which is not yet enabled as this feature
is in flux in the DAWG work.  This may change or be removed in future
versions.</p>

<p><code>roqet</code> can specify a data source URI on the command
line with <code>-s</code> / <code>--source</code>) <em>URI</em> for
queries executing against an implicit model.</p>

<p>Added the
<a href="http://www.w3.org/2001/sw/DataAccess/tests/">DAWG SPARQL test cases</a>
driven from the manifest.n3 format.  Created tests from the examples
in the working draft.</p>

<p>Added an experimental XML result format for bindings, based on
DAWG work.  Enabled in <code>roqet</code> with <code>-o xml</code>.
This is very likely to change or replaced in future versions.</p>

<p>Added <code>roqet</code> argument <code>-d</code> /
<code>--dump-query</code> to dump the processed query, rather than
do it by default (0.9.2 and earlier).</p>

<p><code>roqet</code> can now read queries from URIs, using
the <code>raptor_www</code> class to do the retrieval.</p>

<p>Fixed the <code>configure</code> checks for a posix regex
function regcomp to correctly discover it is present.</p>


<h3>Internal changes</h3>

<p>Added support for declaring prefixes for XML-style QNames both
before and after their use.</p>

<p>The struct <code>rasqal_prefix</code> gained a
<code>declared</code> field.</p>

<p>The struct <code>rasqal_triple</code> gained an origin field; not
used at present but intended to support work on tracking triple
provenance such as provided by Redland Contexts.</p>

<p>Added methods <code>rasqal_triple_set_origin</code> and
<code>rasqal_triple_get_origin</code> to support the above.</p>

<p>struct <code>rasqal_triple_meta</code> now takes a 4-array of
bindings, the fourth being the origin.</p>

<p>Exported function <code>rasqal_set_triples_source_factory</code>
publically as originally intended.
</p>


<h2 id="rel0_9_2"><a name="rel0_9_2">Rasqal 0.9.2 Changes</a></h2>

<p>This release made minor portability fixes for building with
C++ and Win32 (untested).</p>

<p>Several functions changed their parameters or return values from
char* to unsigned char* or const unsigned char* to reflect the
actual use.</p>

<p>Changed to return a <code>const unsigned char*</code>:<br />
<code>rasqal_literal_as_string</code>
</p>

<p>Changed to take <code>const unsigned char*</code> (or add
<code>const</code>):<br />
<code>rasqal_new_floating_literal</code><br />
<code>rasqal_new_pattern_literal</code><br />
<code>rasqal_new_prefix</code><br />
<code>rasqal_new_simple_literal</code><br />
<code>rasqal_new_string_literal</code><br />
<code>rasqal_new_variable</code><br />
<code>rasqal_query_has_variable</code><br />
<code>rasqal_query_results_get_binding_name</code><br />
<code>rasqal_query_results_get_binding_value_by_name</code><br />
<code>rasqal_query_results_get_bindings</code><br />
<code>rasqal_query_set_variable</code><br />
</p>


<h2 id="rel0_9_1"><a name="rel0_9_1">Rasqal 0.9.1 Changes</a></h2>

<p>This release changed the way that results were returned.  A new
<code>rasqal_query_results</code> class was created.  This allows for
a clean separation of the two concepts allowing multiple form of the
results to be retrieved as methods of the query_results class, rather
than the query class.  The only form of results currently available
is variable bindings, but RDF graphs will be returned in future,
as a set of triples in a serialised form.</p>

<p>The execution method <code>rasqal_query_execute</code> was changed
to return a new object of that class rather than an <code>int</code>
success or failure.</p>

<p>The following methods of the <code>rasqal_query</code> class
were renamed and moved to the new <code>rasqal_query_results</code>
class:</p>

<table>
<tr>
<th>0.9.0 name</th> <th>0.9.1+ name</th>
</tr>
<tr>
<td><code>rasqal_query_get_result_count</code></td> <td><code>rasqal_query_results_get_count</code></td>
</tr>
<tr>
<td><code>rasqal_query_next_result</code></td> <td><code>rasqal_query_results_next</code></td>
</tr>
<tr>
<td><code>rasqal_query_results_finished</code></td> <td><code>rasqal_query_results_finished</code></td>
</tr>
<tr>
<td><code>rasqal_query_get_result_bindings</code></td> <td><code>rasqal_query_results_get_bindings</code></td>
</tr>
<tr>
<td><code>rasqal_query_get_result_binding_value</code></td> <td><code>rasqal_query_results_get_binding_value</code></td>
</tr>
<tr>
<td><code>rasqal_query_get_result_binding_name</code></td> <td><code>rasqal_query_results_get_binding_name</code></td>
</tr>
<tr>
<td><code>rasqal_query_get_result_binding_by_name</code></td> <td><code>rasqal_query_results_get_binding_value_by_name</code></td>
</tr>
<tr>
<td><code>rasqal_query_get_bindings_count</code></td> <td><code>rasqal_query_results_get_bindings_count</code></td>
</tr>
</table>

<p>A new <code>rasqal_free_query_results</code> destructor was created
to delete the query results.  (There is no public constructor).</p>

<p>Other minor bugs were fixed such as multiple constraints now being
ANDed and not ORed, and adding defensive code for when queries fail
and results methods are invoked.</p>


<h2 id="rel0_9_0"><a name="rel0_9_0">Rasqal 0.9.0 Changes</a></h2>

<p>
It is all new.
</p>



<hr />

<p>Copyright 2004-2005 <a href="http://purl.org/net/dajobe/">Dave Beckett</a>, <a href="http://www.ilrt.bris.ac.uk/">Institute for Learning and Research Technology</a>, <a href="http://www.bristol.ac.uk/">University of Bristol</a></p>

</body>
</html>
